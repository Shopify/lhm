name: lhm
up:
  - homebrew:
      - mysql-client@5.7:
          or: [mysql@5.7]
          conflicts: [shopify/shopify/mysql-client, mysql-connector-c, mysql, mysql-client]
      - wget
  - ruby: 2.6.5
  - bundler
  - docker
  - custom:
      name: Docker Compose
      met?: docker compose ls | grep -ioE -q "lhm.*running\(3\)"
      meet: docker compose up -d
  - custom:
      name: Waiting for DBs to be operational
      met?: ./scripts/helpers/wait-for-dbs.sh
      meet: ":"

commands:
  unit: bundle exec rake unit
  int: bundle exec rake integration
  test: bundle exec rake unit && bundle exec rake integration
  cov: rm -rf coverage; COV=1 bundle exec rake unit && bundle exec rake integration; open coverage/index.html
  logs:
    desc: "See the DB logs (ctrl-c + ctrl-c to exit)"
    run: docker-compose logs -f
  mysql:
    desc: Open a MySQL console
    run: mysql --protocol=tcp -uroot -ppassword -P 33006
  proxysql:
    desc: Open a ProxySQL console
    run: mysql -h127.0.0.1 -P6032 -uremote-admin -ppassword
